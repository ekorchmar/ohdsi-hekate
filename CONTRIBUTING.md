## Contributing to Hekate
All contributions are welcome! Here are some guidelines to follow when contributing to Hekate.

## Branch policy
Currently, Hekate is being built by a single developer, who commits and pushed to `main` with reckless abandon. Please
contact me via `korchmar@ohdsi.org` if you would like to join the development.

## Testing

### Unit tests
TBD

### Testing environment
TBD

## Tooling

### Virtual environment
We use CPython's built-in `venv` module to manage virtual environments. To create a new virtual environment, run the
following command in the root of the repository:
```bash
python -m venv venv
```

You can activate the virtual environment by running:
```bash
source venv/bin/activate
```
Or, on Windows:
```cmd
venv\Scripts\activate
```

`requirements.txt` file contains all development dependencies, including `pre-commit` hooks and `scalene` profiler. To
install all dependencies, run:
```bash
pip install -r requirements.txt
```

> [!WARNING]
> We are using bleeding edge libraries like Polars that has an unstable API. It is recommended to use the exact
> versions of the libraries specified in `requirements.txt` to avoid any compatibility issues.

### Code style
We use `ruff` for Python code formatting. SQL scripts in `reference/` are formatted with `sqlfluff`.

It is highly recommended to install `pre-commit` and run `pre-commit install` in the root of the repository to ensure
that your code is properly formatted before committing.

### Type annotations
All Python code should be annotated with type hints. We use `basedpyright` to lint the code and ensure that all type
hints are correct.

#### Additional type annotation rules
- `typing.Any` is absolutely disallowed. Use explicit type unions and generic function typing. We work with huge data
  tables which is often legacy, manually curated or generated by old versions of software tools with known bugs.
  Keeping all inputs and outputs strictly typed is crucial for validation and debugging.
- `assert` statements are allowed only to indicate a predicate to be true for the type checker. They should not be used
  for runtime checks and control flow. *Python interpreter with `-O` flag will ignore all `assert` statements.*
